/*! release-plan 2013-12-12 */
(function(){var a,b,c;a=function(){function a(a){var b,c,d,e,f,g,h;for(this.count=0,this.built=0,this.objects=[],this.lines=a.split("\n"),h=this.lines,b=f=0,g=h.length;g>f;b=++f)c=h[b],"wall"===c.trim().toLowerCase()?(d&&this.objects.push(d),this.count++,d=[],d.type="wall"):d&&(e=c.split(":"),2===e.length&&(d[e[0]]=e[1],console.log("Property: "+e[0]+" = "+e[1])));d&&this.objects.push(d)}return a.prototype.ended=function(){return this.built>=this.count},a.prototype.get=function(){var a;switch(a=this.objects[this.built],console.log(a),a.type){case"wall":return this.built++,new c(0,240,270,240,270,44)}},a}(),b=function(){function a(){this.camera=new THREE.PerspectiveCamera(f,b,e,c),this.camera.rotation.x=-.7,this.camera.position.z=600,this.camera.position.y=600,this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(g,d),this.scene=new THREE.Scene,this.scene.add(this.camera),this.pointLight=new THREE.AmbientLight(15658734),this.pointLight.position.x=10,this.pointLight.position.y=50,this.pointLight.position.z=130,this.scene.add(this.pointLight),this.stage=new Kinetic.Stage({container:floorplan,width:g,height:d}),this.layer=new Kinetic.Layer,this.stage.add(this.layer)}var b,c,d,e,f,g;return g=400,d=300,f=45,b=g/d,e=.1,c=1e4,a.prototype.reset=function(){var a,b,c,d,e;for(this.layer.removeChildren(),b=this.scene.children.slice(0),e=[],c=0,d=b.length;d>c;c++)a=b[c],a&&"block"===a.name?e.push(this.scene.remove(a)):e.push(void 0);return e},a.prototype.draw=function(){return this.renderer.render(this.scene,this.camera),this.layer.batchDraw()},a.prototype.add=function(a){return a.mesh.name="block",this.scene.add(a.mesh),this.layer.add(a.polygon),this.draw()},a.prototype.fitToScreen=function(){var a,b,c,e,f,h,i,j,k,l,m,n,o,p;for(h=0,f=0,j=0,i=0,o=this.layer.children,k=0,m=o.length;m>k;k++)for(a=o[k],p=a.getPoints(),l=0,n=p.length;n>l;l++)b=p[l],h>b.x&&(h=b.x),f<b.x&&(f=b.x),j>b.y&&(j=b.y),i<b.y&&(i=b.y);return e=Math.abs(d/(i-j)),c=Math.abs(g/(f-h)),this.stage.setScaleY(-Math.min(c,e)),this.stage.setScaleX(Math.min(c,e)),this.stage.setOffsetY(i),this.draw()},a}(),$(function(){var c,d,e,f,g,h,i,j;return i=400,f=300,h=45,d=i/f,g=.1,e=1e4,j=new b,$("body").keypress(function(a){switch(a.charCode){case 119:j.camera.position.z-=10;break;case 97:j.camera.position.x+=10;break;case 115:j.camera.position.z+=10;break;case 100:j.camera.position.x-=10}return j.renderer.render(j.scene,j.camera)}),$("#text").change(function(b){var c,d;for(j.reset(),c=b.target.value,d=new a(c);!d.ended();)j.add(d.get());return j.fitToScreen()}),c=$("#container"),c.append(j.renderer.domElement),$("textarea#text").change(),j.draw()}),c=function(){function a(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p;this.startx=a,this.starty=b,this.endx=c,this.endy=d,this.height=e,this.width=f,o=new THREE.Texture(this.generateTexture()),o.needsUpdate=!0,p={texture:{type:"t",value:o}},g={},j=new THREE.ShaderMaterial({attributes:g,uniforms:p,vertexShader:document.getElementById("vertex_shader").textContent,fragmentShader:document.getElementById("fragment_shader").textContent}),k=[new THREE.MeshBasicMaterial({color:12307456}),new THREE.MeshBasicMaterial({color:12307456}),new THREE.MeshBasicMaterial({color:12307456}),new THREE.MeshBasicMaterial({color:12307456}),j,new THREE.MeshBasicMaterial({color:13421568})],l=new THREE.MeshFaceMaterial(k),this.mesh=new THREE.Mesh(new THREE.CubeGeometry(this.length(),this.height,this.width),l),this.mesh.rotation.y=Math.atan((this.endy-this.starty)/(this.endx-this.startx)),h=this.endx+this.width*Math.sin(this.mesh.rotation.y),i=this.endy-this.width*Math.cos(this.mesh.rotation.y),m=this.startx+this.width*Math.sin(this.mesh.rotation.y),n=this.starty-this.width*Math.cos(this.mesh.rotation.y),this.mesh.position.x=(h+this.startx)/2,this.mesh.position.z=-(i+this.starty)/2,this.polygon=new Kinetic.Polygon({points:[this.startx,this.starty,this.endx,this.endy,h,i,m,n],fill:"green",stroke:"black",strokeWidth:4})}return a.prototype.generateTexture=function(){var a,b;return a=document.createElement("canvas"),a.width=this.length(),a.height=this.height,b=a.getContext("2d"),b.fillStyle="rgba( 177, 231, 76, 1 )",b.fillRect(0,0,this.length(),this.height),b.fillStyle="rgba( 100, 81, 67, 1 )",b.fillRect(0,0,this.length()/3,this.height),a},a.prototype.length=function(){return Math.sqrt(Math.pow(this.startx-this.endx,2)+Math.pow(this.starty-this.endy,2))},a}()}).call(this);